/////////////////////////////////////////////////////////////////// Algorithm reading the Irene Events and filling Alex Classes:// AHits, AParticles and ATTracks.// Persistency is made by ASvc./////////////////////////////////////////////////////////////////#include "IreneLoader.hh"#include <alex/ISvc.h>#include <alex/PSvc.h>#include <alex/ASvc.h>#include <alex/ATTrack.h>#include <alex/AParticle.h>#include <alex/AHit.h>namespace alex {  //--------------------------------------------------------------------  bool IreneLoader::Init()  //--------------------------------------------------------------------  {    // Set the Debug Level    SetDebugLevel(fDebug);    log4cpp::Category& klog = log4cpp::Category::getRoot();    klog << log4cpp::Priority::INFO << "IreneLoader::Init()" ;    fTracks = 0;    fParticles =0;    ASvc::Instance().Init("INFO");    klog << log4cpp::Priority::INFO << " Set start event to"     << ISvc::Instance().GetStartEvent();    ASvc::Instance().SetStartEvent(      ISvc::Instance().GetStartEvent()) ;    return true;  }    //--------------------------------------------------------------------  bool IreneLoader::Execute()  //--------------------------------------------------------------------  {    log4cpp::Category& klog = log4cpp::Category::getRoot();    klog << log4cpp::Priority::DEBUG << "IreneLoader::Execute()";    SetDebugLevel(fDebug);    klog << log4cpp::Priority::DEBUG << "Clear vectors in ASvc";    // Clear Alex Service    ASvc::Instance().Clear();    klog << log4cpp::Priority::DEBUG << " Set start event to "     << ISvc::Instance().GetEvtNum();    ASvc::Instance().SetEvtNum(      ISvc::Instance().GetEvtNum()) ;// Getting Irene Tracks    klog << log4cpp::Priority::DEBUG << "+++Get tracks from ISvc";    // ITracks =std::vector<const irene::Track*>     ITracks iTracks = ISvc::Instance().GetTracks();    klog << log4cpp::Priority::DEBUG << "-->number of ITracks ="     << iTracks.size();    // Getting Irene Particles    klog << log4cpp::Priority::DEBUG << "+++Get particles from ISvc";    IParticles iParticles = ISvc::Instance().GetParticles();    klog << log4cpp::Priority::DEBUG << "-->number of IParticles ="     << iParticles.size();        // ATTrack    for (int t=0; t<iTracks.size(); t++)     {      fTracks++;      klog << log4cpp::Priority::DEBUG << "Adding track " << t ;      const irene::Track* iTrack = iTracks.at(t);      const irene::Particle* iPart = iTrack->GetParticle();      int id = iPart->GetParticleID();      klog << log4cpp::Priority::DEBUG << "++ new ATTrack() ++" ;      ATTrack* track = new ATTrack();      track->SetLevelDebug(fDebug);      klog << log4cpp::Priority::DEBUG << "++ fill hits ++" ;      FillHits(iTrack,track);      track->SetID(t);      track->SetParticleID(id);      ASvc::Instance().AddTTrack(track);            klog << log4cpp::Priority::DEBUG << "++ new ARTrack() ++" ;      ARTrack* rtrack = new ARTrack();      rtrack->SetLevelDebug(fDebug);      klog << log4cpp::Priority::DEBUG << "++ fill hits ++" ;      FillHits(iTrack,rtrack);      rtrack->SetID(t);      ASvc::Instance().AddRTrack(rtrack);    }    // AParticles    for (int t=0; t<iParticles.size(); t++)     {      fParticles++;      klog << log4cpp::Priority::DEBUG << "Adding particle " << t ;      const irene::Particle* iPart = iParticles.at(t);	    AParticle* aPart = new AParticle();      aPart->SetLevelDebug(fDebug);      aPart->SetID(iPart->GetParticleID());      aPart->SetParticleName(iPart->Name());      aPart->SetCharge(iPart->GetCharge());      aPart->SetVertex(iPart->GetInitialVertex().Vect());      aPart->SetP4(iPart->GetInitialMomentum());      aPart->SetIsPrimary(iPart->IsPrimary());      aPart->SetMotherID(0);      if (!aPart->GetIsPrimary())        aPart->SetMotherID(iPart->GetMother()->GetParticleID());      aPart->SetProperty("CreatorProcess", iPart->GetCreatorProcess());      aPart->SetProperty("TrackLength", std::to_string(iPart->GetTrackLength()));      // Add to service      ASvc::Instance().AddParticle(aPart);                }    const std::vector <alex::ATTrack*> tt = ASvc::Instance().GetTTracks();    const std::vector <AParticle*> ps = ASvc::Instance().GetParticles();    const std::vector <alex::ARTrack*> rt = ASvc::Instance().GetRTracks();        klog << log4cpp::Priority::INFO << "Num particles in ASvc: " << ps.size();    klog << log4cpp::Priority::INFO << "Num TTracks in ASvc: " << tt.size();    klog << log4cpp::Priority::INFO << "Num RTracks in ASvc: " << rt.size();       return true;  }    //--------------------------------------------------------------------  bool IreneLoader::End()  //--------------------------------------------------------------------  {    SetDebugLevel(fDebug);    log4cpp::Category& klog = log4cpp::Category::getRoot();    klog << log4cpp::Priority::INFO << "IreneLoader::End()";    klog << log4cpp::Priority::INFO << "Number of tracks loadded" << fTracks;    klog << log4cpp::Priority::INFO << "Number of particles loaded" << fParticles;    return true;  }//--------------------------------------------------------------------  void PIreneLoader::FillHits(const irene::Track* iTrack, ABTrack* track)//--------------------------------------------------------------------  {    SetDebugLevel("INFO");    log4cpp::Category& klog = log4cpp::Category::getRoot();    klog << log4cpp::Priority::DEBUG << "++IreneLoader::FillHits()--";    IHits iHits = iTrack->GetHits();    klog << log4cpp::Priority::DEBUG << "-->number of IHits ="     << iHits.size();    for (int h=0; h<iHits.size(); h++)       {        const std::pair<TLorentzVector,double> iHit = iHits[h];        AHit* aHit = new AHit();        aHit->SetID(h);        aHit->SetPosition(iHit.first.Vect());        aHit->SetEdep(iHit.second);        track->AddHit(aHit);        if (h==0) track->SetExtreme1(new AHit(*aHit));        if (h==iHits.size()-1) track->SetExtreme2(new AHit(*aHit));              }  }}